<form [formGroup]='addPurchaseForm' (ngSubmit)="purchaseFormSubmit()">
<lib-sub-header-template>
  <span class="action_header">{{headerText}}
    <hum-button *ngIf="!isAddPurchaseFormSubmitted" [isSubmit]="true" [type]="'save'" [text]="'save'">
    </hum-button>
    <hum-button *ngIf="isAddPurchaseFormSubmitted" [type]="'loading'" [text]="'Saving....'"></hum-button>
    <hum-button (click)='cancelButtonClicked()' [type]="'cancel'" [text]="'cancel'"></hum-button>

  </span>
  <div class="action_section">
  </div>
</lib-sub-header-template>
<mat-divider></mat-divider>

<div class="alert alert-warning" *ngIf="exchangeRateMessage != '' && exchangeRateMessage != null" role="alert">
  <p class="txt-center-align">{{exchangeRateMessage}}</p>
</div>

<mat-card [ngStyle]="scrollStyles">

    <div class="row">
        <h4>Item Detail</h4>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['InventoryTypeId'].hasError('required')"
            [options]="inventoryType$" formControlName="InventoryTypeId" [placeHolder]="'Inventory'"
            (change)="getInventoryTypeSelectedValue($event)">
          </lib-hum-dropdown>
        </div>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['InventoryId'].hasError('required')"
            [options]="storeInventory$" formControlName='InventoryId' [placeHolder]="'Inventory(Master)'"
            (change)="getMasterInventorySelectedValue($event)"></lib-hum-dropdown>
        </div>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['ItemGroupId'].hasError('required')"
            [options]="storeItemGroups$" formControlName='ItemGroupId' [placeHolder]="'Item Group'"
            (change)="getItemGroupSelectedValue($event)"></lib-hum-dropdown>
        </div>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['ItemId'].hasError('required')"
            [options]="storeItems$" formControlName='ItemId' [placeHolder]="'Item'"
            (change)="getItemSelectedValue($event)"></lib-hum-dropdown>
        </div>
    </div>

    <div class="row">
        <h4>Project & Analytical Information</h4>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['OfficeId'].hasError('required')"
            [options]="offices$" formControlName='OfficeId' [placeHolder]="'Office'"
            (change)="getOfficeSelectedValue($event)"></lib-hum-dropdown>
        </div>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['ProjectId'].hasError('required')"
            [options]="project$" formControlName='ProjectId' [placeHolder]="'Project'"
            (change)="getProjectSelectedValue($event)"></lib-hum-dropdown>
        </div>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['BudgetLineId'].hasError('required')"
            [options]="budgetLine$" formControlName='BudgetLineId' [placeHolder]="'Budget Line'"
            ></lib-hum-dropdown>
        </div>
    </div>

    <!-- Transport Details-->
    <div class="row" *ngIf="addPurchaseForm.controls['InventoryId'].value === MasterCategory.Transport">

      <div *ngIf="(addPurchaseForm.controls['ItemGroupId'].value === ItemGroups.Vehicle ||
                              addPurchaseForm.controls['ItemGroupId'].value === ItemGroups.Generator) &&
                              addPurchaseForm.controls['ItemId'].value == StoreItems.Vehicle || addPurchaseForm.controls['ItemId'].value == StoreItems.Generator">
        <div class="col-md-10">
          <strong>Note:</strong>The item you have selected is <strong>{{selectedItemGroupName}}</strong>. Therefore, the
          following <strong>transport related metadata</strong> must be filled out.
        </div>
        <div class="col-md-2">
          <div class="items-float-right">
            <hum-button (click)='addTransportItemButtonClicked(addPurchaseForm.controls["ItemGroupId"].value)'
              [type]="'add'" [text]="'Add'"></hum-button>
          </div>
        </div>
      </div>
      <div class="row" *ngIf="addPurchaseForm.controls['ItemGroupId'].value === ItemGroups.Vehicle && addPurchaseForm.controls['ItemId'].value === StoreItems.Vehicle">
        <div class="col-md-12">
          <mat-accordion>
            <mat-expansion-panel formArrayName="TransportVehicles"
              *ngFor="let item of addPurchaseForm.controls['TransportVehicles'].controls; let i= index">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h4>New Vehicle Detail Form - {{item.get('PlateNo').value}}</h4>
                </mat-panel-title>
                <hum-button (click)='deleteVehicle(i)' [type]="'remove'" [text]="'Remove'"></hum-button>
              </mat-expansion-panel-header>
              <app-vehicle-detail [formGroupName]="i" [officeId]='addPurchaseForm.controls["OfficeId"].value'
                [vehicleDetailForm]='item'></app-vehicle-detail>
            </mat-expansion-panel>
          </mat-accordion>
        </div>
      </div>

      <div class="row" *ngIf="addPurchaseForm.controls['ItemGroupId'].value === ItemGroups.Generator && addPurchaseForm.controls['ItemId'].value === StoreItems.Generator">
        <div class="col-md-12">
          <mat-accordion>
            <mat-expansion-panel formArrayName="TransportGenerators"
              *ngFor="let item of addPurchaseForm.controls['TransportGenerators'].controls; let i= index">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h4>New Generator Detail Form - {{item.get('Voltage').value}}</h4>
                </mat-panel-title>
                <hum-button (click)='deleteGenerator(i)' [type]="'remove'" [text]="'Remove'"></hum-button>
              </mat-expansion-panel-header>
              <app-generator-detail [formGroupName]="i" [officeId]='addPurchaseForm.controls["OfficeId"].value'
                [generatorDetailForm]='item'></app-generator-detail>
            </mat-expansion-panel>
          </mat-accordion>
        </div>
      </div>

      <div *ngIf="(addPurchaseForm.controls['ItemId'].value !== StoreItems.Vehicle && addPurchaseForm.controls['ItemId'].value !== StoreItems.Generator)
                  && (addPurchaseForm.controls['ItemGroupId'].value == ItemGroups.Generator || addPurchaseForm.controls['ItemGroupId'].value == ItemGroups.Vehicle) && addPurchaseForm.controls['ItemId'].value != null" class="paddingleft">
      <div class="row">
        <div class="col-md-12">
          <strong>Note:</strong>The item you have selected is <strong>{{selectedItemName}}</strong>. Therefore, the
          following <strong>transport
            related metadata</strong> must be filled out.
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['TransportItemId'].hasError('required')"
            [options]="purchaseItemDataSource$" formControlName='TransportItemId' [placeHolder]="transportItemPlaceholder"></lib-hum-dropdown>
        </div>
      </div>
      </div>
    </div>

    <div class="row">
        <h4>Purchase Detail</h4>
        <div class="col-md-3">
          <mat-form-field>
            <input matInput formControlName='PurchaseName' placeholder="Purchase Name">
          </mat-form-field>
        </div>
        <div class="col-md-3">
          <mat-form-field>
            <input matInput type="number" formControlName='PurchaseOrderNo' placeholder="Purchase Order No">
          </mat-form-field>
        </div>
        <div class="col-md-3">
          <mat-form-field>
            <input matInput [matDatepicker]="PurchaseOrderDate" (dateChange)="PurchaseDateChange($event)"
              formControlName='PurchaseOrderDate' placeholder="Purchase Order Date">
            <mat-datepicker-toggle matSuffix [for]="PurchaseOrderDate"></mat-datepicker-toggle>
            <mat-datepicker #PurchaseOrderDate></mat-datepicker>
          </mat-form-field>
        </div>
        <div class="col-md-3">
          <mat-form-field>
            <input matInput [matDatepicker]="InvoiceDate" formControlName='InvoiceDate' placeholder="Invoice Date">
            <mat-datepicker-toggle matSuffix [for]="InvoiceDate"></mat-datepicker-toggle>
            <mat-datepicker #InvoiceDate></mat-datepicker>
          </mat-form-field>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
          <mat-form-field>
            <input matInput type="number" formControlName='InvoiceNo' placeholder="Invoice No">
          </mat-form-field>
        </div>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['AssetTypeId'].hasError('required')"
            [options]="assetType$" formControlName='AssetTypeId' [placeHolder]="'Asset Type'"
            ></lib-hum-dropdown>
        </div>
    </div>

    <div class="row">
        <h4>Quantity & Price Detail</h4>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['Unit'].hasError('required')" [options]="unit$"
            formControlName='Unit' [placeHolder]="'Unit'"></lib-hum-dropdown>
        </div>
        <div class="col-md-3">
          <mat-form-field>
            <input matInput type="number" formControlName='Quantity' placeholder="Quantity">
          </mat-form-field>
        </div>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['CurrencyId'].hasError('required')"
            [options]="currency$" formControlName='CurrencyId' [placeHolder]="'Currency'"
            ></lib-hum-dropdown>
        </div>
        <div class="col-md-3">
          <mat-form-field>
            <input matInput type="number" formControlName='Price' placeholder="Price">

          </mat-form-field>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
          <mat-form-field>
            <input matInput [matDatepicker]="ReceiptDate" formControlName='ReceiptDate' placeholder="Receipt Date">
            <mat-datepicker-toggle matSuffix [for]="ReceiptDate"></mat-datepicker-toggle>
            <mat-datepicker #ReceiptDate></mat-datepicker>
          </mat-form-field>
        </div>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['ReceivedFromLocation'].hasError('required')"
            [options]="storeSource$" formControlName='ReceivedFromLocation' [placeHolder]="'Received From Location'"
            ></lib-hum-dropdown>
        </div>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['ReceivedFromEmployeeId'].hasError('required')"
            [options]="employeeList$" formControlName='ReceivedFromEmployeeId' [placeHolder]="'Received From Employee'"
            ></lib-hum-dropdown>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['ReceiptTypeId'].hasError('required')"
            [options]="receiptType$" formControlName='ReceiptTypeId' [placeHolder]="'Receipt Type'"
            ></lib-hum-dropdown>
        </div>
        <div class="col-md-3">
          <lib-hum-dropdown [validation]="addPurchaseForm.controls['StatusId'].hasError('required')"
            [options]="statusList$" formControlName='StatusId' [placeHolder]="'Status'"
            ></lib-hum-dropdown>
        </div>
    </div>

    <div class="row">
        <h4>Depreciation</h4>
        <div class="col-md-3">
          <mat-checkbox formControlName='ApplyDepreciation'>Apply Depreciation</mat-checkbox>
        </div>
        <div class="col-md-3">
          <mat-form-field>
            <input matInput type="number" formControlName='DepreciationRate' placeholder="Depreciation Rate(%)">
          </mat-form-field>
        </div>
      </div>
    <div class="row">
      <div class="col-md-12">
        <h4 style="padding-left: 0px !important">Documents
          <hum-button [type]="'add'" [text]="'add'" (click)="openAddDocumentDialog()"></hum-button>
        </h4>
        <app-document-upload [showDownloadButton]="showDownloadButton" [hideColums$]="hideUnitColums" [purchasedDocumentFiles]="uploadedPurchasedFiles" (documentButtonClicked)="onPurchaseDocumentButtonClick($event)"></app-document-upload>
      </div>
    </div>
</mat-card>
</form>
